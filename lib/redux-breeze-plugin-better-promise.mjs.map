{"version":3,"file":"redux-breeze-plugin-better-promise.mjs","sources":["../src/index.js"],"sourcesContent":["import _ from 'lodash';\nimport { set } from 'perfect-immutable';\n\nconst getResultsAssignments = (resultDefinition, action = {}, state = {}) => {\n  const result = _.isFunction(resultDefinition) ? resultDefinition(action) : resultDefinition;\n  return _.reduce(result, (accu, source, target) => {\n    if (_.isFunction(source)) {\n      accu[target] = source(action, _.get(state, target));\n    } else if (_.isPlainObject(source)) {\n      if (_.isFunction(source.source)) {\n        accu[target] = source.source(action, _.get(state, target));\n      } else if (_.has(source, 'default') && !_.has(action, source.source)) {\n        accu[target] = source.default;\n      } else {\n        accu[target] = _.get(action, source.source);\n      }\n    } else {\n      accu[target] = _.get(action, source);\n    }\n    return accu;\n  }, {});\n};\n\nconst getInitialStateAssignments = resultDefinition => {\n  const result = _.isFunction(resultDefinition) ? resultDefinition({}) : resultDefinition;\n  return _.reduce(result, (accu, source, target) => {\n    if (_.isPlainObject(source) && _.has(source, 'initial')) {\n      accu[target] = source.initial;\n    } else {\n      accu[target] = null;\n    }\n    return accu;\n  }, {});\n};\n\nconst createBetterPromisePlugin = ({ createActionType }, config) => ({\n  name: 'redux-breeze-plugin-better-promise',\n\n  /**\n   * Object of functions that gets `actionDefinition` and `actionName` as arguments and return action creator\n   */\n  actionAdapter: {\n    'better-promise': (actionDefinition, actionName) => (params, hooks) => {\n      const action = {\n        types: { start: createActionType(actionName), success: createActionType(actionName, 'success'), error: createActionType(actionName, 'error') },\n      };\n\n      if (actionDefinition.async) {\n        action.promise = tools => actionDefinition.async(params, tools);\n      }\n\n      if (actionDefinition.sync) {\n        action.function = tools => actionDefinition.sync(params, tools);\n      }\n\n      if (hooks) {\n        action.hooks = hooks;\n      }\n\n      return action;\n    },\n  },\n\n  /**\n   * Object of functions that gets `actionDefinition`, `actionName`, and `initialState` and returns a reducer\n   */\n  reducerAdapter: {\n    'better-promise': (actionDefinition, actionName, initialState) => (state = initialState, action) => {\n      switch (action.type) {\n        case createActionType(actionName):\n          return set(state, {\n            [`pending.${actionName}`]: true,\n          });\n        case createActionType(actionName, 'success'):\n          return set(state, {\n            [`pending.${actionName}`]: false,\n            [`lastSucceeded.${actionName}`]: true,\n            [`lastFailed.${actionName}`]: false,\n            [`succeeded.${actionName}`]: true,\n            ...(actionDefinition.result\n              ? getResultsAssignments(actionDefinition.result, action, state)\n              : { [`result.${actionName}`]: action.result }),\n          });\n        case createActionType(actionName, 'error'):\n          return set(state, {\n            [`pending.${actionName}`]: false,\n            [`lastSucceeded.${actionName}`]: false,\n            [`lastFailed.${actionName}`]: true,\n            [`failed.${actionName}`]: true,\n            ...(actionDefinition.error\n              ? getResultsAssignments(actionDefinition.error, action, state)\n              : { [`error.${actionName}`]: action.error }),\n          });\n        default:\n          return state;\n      }\n    },\n  },\n\n  /**\n   * Object of functions that gets `actionDefinition` and `actionName` as arguments and return assignment object (with keys = paths, values = values to be saved in those paths)\n   */\n  initialStateAdapter: {\n    'better-promise': (actionDefinition, actionName) => ({\n      [`pending.${actionName}`]: false,\n      [`lastSucceeded.${actionName}`]: false,\n      [`lastFailed.${actionName}`]: false,\n      [`succeeded.${actionName}`]: false,\n      [`failed.${actionName}`]: false,\n      ...(actionDefinition.result\n        ? getInitialStateAssignments(actionDefinition.result)\n        : { [`result.${actionName}`]: null }),\n      ...(actionDefinition.error\n        ? getInitialStateAssignments(actionDefinition.error)\n        : { [`error.${actionName}`]: null }),\n    }),\n  },\n});\n\nexport default createBetterPromisePlugin;\n"],"names":["getResultsAssignments","resultDefinition","action","state","result","_","isFunction","reduce","accu","source","target","get","isPlainObject","has","default","getInitialStateAssignments","initial","createBetterPromisePlugin","config","createActionType","actionDefinition","actionName","params","hooks","start","success","error","async","promise","tools","sync","function","initialState","type","set"],"mappings":"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"}